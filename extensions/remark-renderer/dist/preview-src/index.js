(()=>{"use strict";const e=acquireVsCodeApi();class t{constructor(){this.cachedElements=[],this.codeLineClass="code-line",this.isFromEditor=!1,this.setIsFromEditor=((e,t)=>{let n=null;return(...t)=>{n&&clearTimeout(n),n=setTimeout(e.bind(void 0,...t),100)}})((()=>{this.isFromEditor=!1})),this.getCodeLineElements(),this.initListener()}initListener(){window.addEventListener("message",(e=>{switch(e.data.command){case"changeTextEditorSelection":return this.isFromEditor=!0,this.scrollToRevealSourceLine(e.data.line),void this.setIsFromEditor();case"updateContent":const t=document.querySelector(".md-typeset"),n=(new DOMParser).parseFromString(e.data.content,"text/html");return t.replaceWith(n.querySelector(".md-typeset")),MathJax.typeset(),void this.getCodeLineElements()}})),window.addEventListener("scroll",(()=>{window.requestAnimationFrame((()=>{if(this.isFromEditor)return;const t=this.getEditorLineNumberForPageOffset(window.scrollY);e.postMessage({command:"revealLine",line:t})}))}))}getCodeLineElements(){this.cachedElements=[];for(const e of Array.from(document.getElementsByClassName(this.codeLineClass))){const t=parseInt(e.getAttribute("data-line"));isNaN(t)||("CODE"===e.tagName&&e.parentElement&&"PRE"===e.parentElement.tagName?this.cachedElements.push({element:e.parentElement,line:t}):this.cachedElements.push({element:e,line:t}))}}getElementsForSourceLine(e){const t=Math.floor(e),n=this.cachedElements;let o=n[0]||null;for(const e of n){if(e.line===t)return{previous:e,next:void 0};if(e.line>t)return{previous:o,next:e};o=e}return{previous:o}}getLineElementsAtPageOffset(e){const t=this.cachedElements,n=e-window.scrollY;let o=-1,i=t.length-1;for(;o+1<i;){const e=Math.floor((o+i)/2),s=this.getElementBounds(t[e]);s.top+s.height>=n?i=e:o=e}const s=t[i],r=this.getElementBounds(s);return i>=1&&r.top>n?{previous:t[o],next:s}:i>1&&i<t.length&&r.top+r.height>n?{previous:s,next:t[i+1]}:{previous:s}}getElementBounds({element:e}){const t=e.getBoundingClientRect(),n=e.querySelector(`.${this.codeLineClass}`);if(n){const e=n.getBoundingClientRect(),o=Math.max(1,e.top-t.top);return{top:t.top,height:o}}return t}scrollToRevealSourceLine(e){if(e<=0)return void window.scroll(window.scrollX,0);const{previous:t,next:n}=this.getElementsForSourceLine(e);if(!t)return;let o=0;const i=this.getElementBounds(t),s=i.top;if(n&&n.line!==t.line)o=s+(e-t.line)/(n.line-t.line)*(n.element.getBoundingClientRect().top-s);else{const t=e-Math.floor(e);o=s+i.height*t}o=Math.abs(o)<1?Math.sign(o):o;const r=Math.max(1,window.scrollY+o);window.scroll(window.scrollX,r)}getEditorLineNumberForPageOffset(e){const{previous:t,next:n}=this.getLineElementsAtPageOffset(e);if(t){const o=this.getElementBounds(t),i=e-window.scrollY-o.top;if(n){const e=i/(this.getElementBounds(n).top-o.top);return t.line+e*(n.line-t.line)}{const e=i/o.height;return t.line+e}}return null}}function n(){new t}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n()})();